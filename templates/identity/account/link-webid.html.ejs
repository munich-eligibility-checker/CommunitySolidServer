<h1>WebID verknüpfen</h1>
<form method="post" id="mainForm">
  <p class="error" id="error"></p>

  <fieldset>
    <p>Wählen Sie die WebID, die mit diesem Konto verknüpft werden soll</p>
    <ol>
      <li>
        <label for="webId">WebID</label>
        <input id="webId" type="text" name="webId" autofocus placeholder="https://example.org/profile#me">
      </li>
    </ol>
  </fieldset>

  <ul class="actions">
    <li><button type="submit" name="submit" disabled>WebID mit Konto verknüpfen</button></li>
    <li><button type="button" id="account-link">Zurück</button></li>
  </ul>
</form>
<div class="hidden" id="response">
  <p>
    Sie müssen das folgende Triple manuell zu Ihrem bestehenden WebID-Dokument
    <em id="response-existingWebId"></em> hinzufügen,
    um anzuzeigen, dass Sie diesem Server als Anmeldeanbieter vertrauen:
  </p>
  <p>
    <strong><code id="oidc-triple"></code></strong>
  </p>

  <p class="actions"><button type="button" id="response-account-link">Zurück</button></p>
</div>


<script>
  (async() => {
    const controls = await fetchControls('<%= idpIndex %>');
    setRedirectClick('account-link', controls.html.account.account);
    setRedirectClick('response-account-link', controls.html.account.account);

    addPostListener(async() => {
      const { webId, oidcIssuer } = await postJsonForm(controls.account.webId);
      updateElement('oidc-triple', `<${webId}> <http://www.w3.org/ns/solid/terms#oidcIssuer> <${oidcIssuer}>.`, { innerText: true });
      setVisibility('response', true);
      setVisibility('mainForm', false);
    });
  })();
</script>
